#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

/*

*/

char* main_name = 0x0;

int name_count; // The amount of user already created
int name_upgrades_count; // The amount upgrades on names

// Create a new name
void build_name(){
	int length; 
	char tmp[20];

	// Too many people!
	if(name_count > 4){
		puts("Name creation failed... Too many people");
		return;	
	}

	// Get the length of the plant	
	printf("Get name length : ");	
	fgets(tmp, 10, stdin);
	length = atoi(tmp);
	if(length > 0x1000){
		length = 0x1000;
	}

	// Get input for the plant.
	char* name = malloc(length);
	printf("Get name : ");
	read(0, name, length);

	main_name = name;
	name_count += 1;

	// Leak the heap address
	printf("Your name is at %p\n", main_name);
}

// Upgrade a name
void upgrade_name(){
        int length; 
        char tmp[20];

        // Too many people!
        if(name_upgrades_count > 4){
                puts("Name update failed... Have a sense of identity!");
                return;
        }

        // Get the length of the plant  
        printf("New name length : ");
        fgets(tmp, 10, stdin);
        length = atoi(tmp);
        if(length > 0x1000){
                length = 0x1000;
        }

        printf("Get updated name : ");
        read(0, main_name, length);
	return;
}

// See the name
void see_name(){
	printf("Your current name is: %s", main_name);
}

// Get an integer option
int get_option(){
	char tmp[20]; 
	int option; 

	printf("The name game (limit 4 still under construction)\n");
	printf("================================================\n");
	printf("1. Add Name\n");
	printf("2. Update Name\n");
	printf("3. See Name\n");
	printf("4. QUIT\n");
	printf(">");

	fgets(tmp, 10, stdin);	
	option = atoi(tmp);
	return option;
}

void init(){
	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stdin, NULL, _IONBF, 0);
	clearenv();
}

int main(){
	// Meant to mimic the OG house of orange challege but with easier memory leaks :) 
	// Leak heap address, in order to make life easier :) 
	int option;
	init();
	while(1){
		option = get_option();
		if(option == 1){
			build_name();
		}
		else if(option == 2 && main_name != 0x0){
			upgrade_name();
		}
		else if(option == 3 && main_name != 0x0){
			see_name();
		}
		else {
			return 0;
		}
		printf("\n\n\n");
	}

}
