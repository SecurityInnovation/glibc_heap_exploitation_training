#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

/* 
Timmy has built his own string class!

Compile: `gcc magic_value.c -o magic_value -g -O0`

*/

long long magic = 0x1337;
char* strings[100]; // Global storage of strings

char* create_string(){

	// Ptr to new string	
	char* new_string = malloc(0x90);	

	printf("Please enter your string\n> ");
	// Put data into string	
	read(0, new_string, 0x90);

	return new_string;
}

// Free the string 
int delete_string(char* string){
	free(string);
	printf("String deleted\n");
	return 0;
}


// Edit a string
int* edit_string(char* string){
	printf("Please enter your new string content\n>");
	read(0, string, 0x90);	
}

// View a string
void* view_string(char* string){
	printf("Your string:\n");
	write(1, string, 0x90);
}

void init(){
        setvbuf(stdout, NULL, _IONBF, 0);
        setvbuf(stdin, NULL, _IONBF, 0);
        clearenv();
}

void banner(){
	puts("Welcome to Timmy's strings. This is the CLI to play with:)");
	puts("1. Create New String"); 
	puts("2. Edit Old String"); 
	puts("3. Delete String"); 
	puts("4. View String"); 
	printf(">");
}

int main(){
	init();	
	int option; 
	int iter = 0; 
	char tmp_option[20]; 

	while(1){
		banner();
		fgets(tmp_option, 20, stdin);
		option = atoi(tmp_option);

		// Create String
		if(option == 1){	
			strings[iter] = create_string(); 
			printf("New string added to index %d\n", iter);
			iter += 1; 
		}
		// Edit String
		else if(option == 2){	
			printf("Index >");
			fgets(tmp_option, 20, stdin);
			option = atoi(tmp_option);

			if(option >= 0 && option <= iter -1){
				edit_string(strings[option]);
			}
			else {
				puts("Improper Index");
			}
		}
		// Delete String
		else if(option == 3){
			printf("Index >");

			fgets(tmp_option, 20, stdin);
			option = atoi(tmp_option);
			if(option >= 0 && option <= iter - 1){
				delete_string(strings[option]);
				iter = iter - 1; // Top chunk consolidation...
			}
			else {
				puts("Improper Index");
			}

		}
		// View String
		else if(option == 4){
			printf("Index >");

			fgets(tmp_option, 20, stdin);
			option = atoi(tmp_option);
			if(option >= 0 && option <= iter - 1){
				view_string(strings[option]);
			}
			else {
				puts("Improper Index");
			}
		}
		// Exit (leave)
		else if(option == 5){
			return 1; 
		}
		else if(option == 1337){
			printf("Magic: 0x%llx\n", magic);
			if(magic > 0x1337){
				puts("Winner!"); 
				return 0; 
			}else{
				printf("Wrong :(");
			}

		}
	}
}


