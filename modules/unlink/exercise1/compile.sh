#!/bin/bash 

# Compilation script for this challenge :) 
# Deals with the elfpatching and versioning for us

all_versions="2.23_unlink"
file_name=(unlink)


for file_name in "${file_name[@]}" 
do 

	# Compile the code
	gcc $file_name.c -o $file_name -ggdb -O0 -no-pie
	echo "./.$file_name-$all_versions"
	# Copy into a new version specific file 	
	cp $file_name ./.$file_name-$all_versions
	
	# Get the loader and patch the loader of the new file
	loader=$(realpath $(pwd)/../../../libc_versions/$all_versions/ld-2.23_unlink.so)
	patchelf --set-interpreter $loader ./.$file_name-$all_versions

done



