#!/bin/bash 

# Compilation script for this challenge :) 
# Deals with the elf patching and versioning for us

version=( 2.31 )
file_name=book_shop

# Compile the code for regular mmap technique
$(gcc book_shop.c -o $file_name -g -fPIE -pie -Wl,-z,relro,-z,now -D_FORTIFY_SOURCE=2)

cp $file_name ./.$file_name-$version
loader=$(realpath $(pwd)/../../libc_versions/$version/ld-$version.so)
        patchelf --set-interpreter $loader ./.$file_name-$version

## Special leakless techique -- need to remove RELRO
# PIE could be turned on, but does not have to be (for ease-of-use) 
$(gcc book_shop.c -o ./$file_name-leakless -g -D_FORTIFY_SOURCE=2)

cp $file_name ./.$file_name-leakless
patchelf --set-interpreter $loader ./.$file_name-leakless
