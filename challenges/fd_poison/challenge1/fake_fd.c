#include <stdlib.h>
#include <stdio.h>

char important_string[0x20] = "You can't touch this"; 

int main(){
	setvbuf(stdout, NULL, _IONBF, 0);

	// Allocate a chunk of size 0x30 
	char* data = malloc(0x20); 

	// Put the chunk into the 0x30 tcache bin
	// Creates a use after free (UAF)!!
	free(data); 	

	printf("Enter Data: ");

	// Write into the data variable after it has been freed
	// Exploit use after free!!
	fgets(data, 0x20, stdin); 

	// Allocate new chunk
	malloc(0x20); 

	printf("Enter victim: "); 

	// Alocate our fake chunk
	char* victim = malloc(0x20); 

	// Write into the fake chunk
	fgets(victim, 0x20, stdin);

	printf("Important String: %s\n", important_string); 
	return 0; 
}
