from pwn import * 

mode = 'DEBUG' # Turn on gdb
libc_name='../../../libc_versions/2.23/libc-2.23.so'
env = {}

# Binary setup
elf_name = './.fix_chunk'

elf = ELF(elf_name)
if libc_name != '':
        libc = ELF(libc_name)
        env = {"LD_PRELOAD": libc.path}

# Process creation 
if mode == 'DEBUG':
        p = process([elf.path],env=env)
        gdb.attach(p, gdbscript='''
dir ../../../libc_versions/2.23/
''')

# To help with debugging
p.sendlineafter("continue", "Go!")

'''
Below is the heap layout: 
=============================

bottom - 0xa0 (free)
-----------
top    - 0x110 (in use) <---- Fixing THIS chunk
-----------
filler - 0x20 (in use) 
-----------

The previous chunks IS in use. So, this means that the 
'prev_size' field of the 'top' chuk is not in use. 

So, we don't need to change this value.
'''
prev_size = p64(0x0)

size = p64(0x0 | 0x0) # TODO: Edit the 'size' and 'size metadata' of the 'top' chunk

# Send off the data
p.sendline(prev_size + size)

p.interactive()
