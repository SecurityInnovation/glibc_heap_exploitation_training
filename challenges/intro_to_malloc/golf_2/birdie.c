#include <stdlib.h>
#include <stdio.h>

/*
gcc birdie.c -o birdie -O0 -ggdb
*/

void* create_birdie(int index){
	
	int* ptr = malloc(0x100);
	printf("Creating ptr %d\n", index);

	// FILLER TO PREVENT CONSOLIDATION
	malloc(0x110);

	// Sets our index value :) 	
	ptr[1] = index;

	printf("Ptr: %p - %d\n", ptr, ptr[1]);
	return ptr;	
}

void* bogey(int* ptr){
	printf("Remove Ptr: %p\n", ptr);
	free(ptr);
}

void* options(){
	printf("Options: \n");
	puts("1. Birdie");
	puts("2. Bogey");
	puts("3. Win?");
	printf("> ");
}

// Should be run on a version without tcache
int main(){
	setvbuf(stdout,0,2,0);
        setvbuf(stdin,0,2,0);
	clearenv();	

	int *ptr_lst[50];
	int option;
	int last_index = 0;
	int begin_index = 0;

	// Pre-condition <-- add FIVE ITEMS to the start
	for (int i = 0; i < 5; i++){
		ptr_lst[last_index] = create_birdie(last_index);
		last_index += 1;
	}	

	while(1){
		options();

		scanf("%d", &option);
		if(option == 1){
			ptr_lst[last_index] = create_birdie(last_index);
			last_index += 1;
		}

		else if(option == 2 && begin_index != last_index){
			printf("Removing ptr at index %d\n", begin_index);
			bogey(ptr_lst[begin_index]);
			begin_index = begin_index + 1;
		}

		// Did you win?
		else if(option == 3){
			// Check the second index of the array
			if(ptr_lst[1][1] == 10){
				printf("Flag...23u40ojfdlJSFOLASJF\n");		
			}else{
				printf("Keep going!\n");
			}
		}
		
	}

	return 0;
}

