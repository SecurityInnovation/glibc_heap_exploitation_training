#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>

/*
Compile: 
 - gcc unlink.c -g -o unlink -z execstack -s
*/

// Easy function to jump to for win :) 
void winner()
{
	printf("Flag!\n:)\n:)");
}

// Making heap and stdin/stdout easier to deal with 
void* setup(){
        setvbuf(stdout,0,2,0);
        setvbuf(stdin,0,2,0);
}

int main(int argc, char **argv)
{
	setup();

	char shellcode[0x80]; 
	char *a, *b, *c;

	// Not fastbin chunks
	// Placed into the 0x90 bins
	b = malloc(0x80);
	c = malloc(0x80);

	// Yes, you can write NULLbytes to these locations
	puts("Enter Shellcode:");
	fgets(shellcode, 0x80, stdin);  // Shellcode?

	puts("Enter unlink payload:");
	fgets(b, 0x90, stdin); // <-- Write fd and bk and overwrite prev_inuse bit

	// Start the unlink!
	free(c);

	puts("dynamite failed?\n");
}
