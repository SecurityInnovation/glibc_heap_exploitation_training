#include <stdio.h>
#include <stdlib.h>

/*
Compile: `gcc shinning_moments.c -o shinning_moments -g -fPIE`
*/
void init(){
        setbuf(stdout, NULL);
        setbuf(stdin, NULL);
        clearenv();
}

void* freedom(){
	void* ptr = malloc(0x1024); 
	
	// Heap leak 
	printf("Here's some cash for your story: %p\n", ptr-0x10); 
	free(ptr); 

	// LibC leak 
	printf("And here's a little more: %p\n", &system); 

	// Stack Leak
	printf("Please tell another one, I'll do anything: %p\n", &ptr); 

}

void* pop_shell(){
	system("/bin/sh");
}

int main(){
	init(); 
	freedom(); 
	
	char* first; 
	char* second; 
	char* third; 
	unsigned long long size; 
	char tmp[28];

	first = malloc(0x1024); 
	free(first);

	// What's your shinning moment? 
	printf("What's your shinning moment?\n"); 	
	fgets(first - 0x10, 0x1024, stdin); 

	// Get the size
	printf("How BIG was your moment?\n");
	fgets(tmp, 28, stdin); 
	
	size = strtoull(tmp, &third, 10); 

	// Your choice!	
	second = malloc(size); 

	// One more time!
	third = malloc(0x20); 
	printf("Tell me, again, about the moment ;)\n");	
	fgets(third, 0x20, stdin);	

	puts("Boom goes the dynamite!\n"); 
	malloc(0x0); 
}
