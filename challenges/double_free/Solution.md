## Solutions 

### Challenge 1 
- Fastbins have a security check in place to see if the item on the top of the bin is the same as the item being freed. 
	- https://elixir.bootlin.com/glibc/glibc-2.23/source/malloc/malloc.c#L3933
- To trigger the crash, free the same pointer twice in a row. 

### Challenge 2 
- From challenge 1, we know that there is a check in place to see if the top of the bin is the same item as being freed. 
- To circumvent this, we just free an item, free a different item, then free the first item again. 
	- This bypasses the on top check.

### Challenge 3 
- Not possible... the chunk (in the unsorted bin) has a security check to see if the chunk is in use or not. 
- This is done by traversing to the nextchunks PREV_INUSE bit. 
	- https://elixir.bootlin.com/glibc/glibc-2.23/source/malloc/malloc.c#L3984
- If this bit is not set, then it is assumed that a double free/ memory corruptin has occurred.

### Challenge 4 
- The original implementation of Tcache had NO double free checks. 
- So, double freeing is as simple as freeing the same item twice. 
- Code for inserting a chunk into the tcache: 
	- https://elixir.bootlin.com/glibc/glibc-2.26/source/malloc/malloc.c#L2949

## Challenge 5 
- Tcache 2.29 and on have a double free check to ensure that all items within the tcache bin are unique pointers.
	- This is done with the 'key', which is pointer to the tcache itself.
	- This pointer is placed in the tcache_put function onto the chunk at the location of where the 'bk' would be at on the traditional chunk.
	- https://elixir.bootlin.com/glibc/glibc-2.29/source/malloc/malloc.c#L4201
- The Tcache has a **limit** on the amount of chunks that can be within a bin (defaults to 7). 
- If you fill up a tcache bin then the overflow will go into the fastbin/unsorted bin.
- Because of the limit, we can fill up the tcache. Allocate 8 chunks, then free all 8 of them:
	- The tcache bin will be full. Then, there will be a single chunk in the fast/unsorted bin.
	- At this point, this is a major temptation to free one of the ptrs again (DON'T)
	- The tcache double free check appears on all pointers (even if the tcache bin is full). Freeing any of the chunks will cause the program to crash.
- Allocate a single chunk.
	- Now, the tcache bin is no longer full.
- Free chunk 8 (the fast/unsorted bin chunk). 
	- This will add the chunk to the tcache bin, while the chunk was already in the fast/unsorted bin! 
- You have bypassed the double free :)
