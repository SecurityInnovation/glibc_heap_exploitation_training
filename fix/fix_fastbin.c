#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>

int main(){
	// Allowing socat to work
  	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stdin, NULL, _IONBF, 0);
	setvbuf(stderr, NULL, _IONBF, 0);
	
	// Fastbin chunk
	char* ptr1 = malloc(0x40);
	printf("Ptr to heap: %p\n", ptr1);
	// Free the chunk, into the 0x50 fastbin	
	free(ptr1);

	// Move the ptr to the back of the chunk	
	char* alt_ptr1 = ptr1 - 0x10;
	printf("Ptr to actual chunk: %p\n", alt_ptr1);
	printf("Prev Size: 0x%x\n", *alt_ptr1);
	printf("Size: 0x%x\n", *(alt_ptr1 + 0x8));

	// Clear/corrupt the chunk
	memset(alt_ptr1, 0, 0x10);	

	// Enter data to fix the chunk
	printf("Enter data to fix the chunk: ");
	read(0, alt_ptr1, 0x10);

	// Get the chunk out of the bin
	malloc(0x40);
	puts("Hooray! The chunks okay :)");
	return 0;

}
