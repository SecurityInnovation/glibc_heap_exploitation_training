#!/bin/bash 

# Deals with the elfpatching and versioning for us

all_versions=( 2.23) 
file_name=house_of_storm

# Compile the code
$(gcc $file_name.c -no-pie -o $file_name -ggdb -O0) 
for version in "${all_versions[@]}" 
do 

	echo "./.$file_name-$version"
	# Copy into a new version specific file 	
	cp $file_name ./.$file_name-$version
	
	# Get the loader and patch the loader of the new file
	loader=$(realpath $(pwd)/../../libc_versions/$version/ld-$version.so)
	patchelf --set-interpreter $loader ./.$file_name-$version 

done
