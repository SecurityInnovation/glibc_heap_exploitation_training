#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

/* 

Timmy has built his own string class!

Large Bin Attack Challenge
Compile: `gcc magic_value.c -o magic_value -g -O0`
*/

int magic1 = 0x1337;
int magic2 = 0x420; 

char* create_string(){

	int size; 
	printf("Size of string\n>");
	scanf("%d", &size); 

	// Ptr to new string	
	char* new_string = malloc(size);

	printf("Please enter your string\n> ");
	// Put data into string	
	read(0, new_string, 0x90);

	return new_string;
}

// Free the string 
int delete_string(char* string){
	free(string);
	printf("String deleted\n");
	return 0;
}


// Edit a string
int* edit_string(char* string){
	printf("Please enter your new string content\n>");
	read(0, string, 0x90);	
}

// View a string
void* view_string(char* string){
	printf("Your string:\n");
	write(1, string, 0x90);
}

void init(){
        setvbuf(stdout, NULL, _IONBF, 0);
        setvbuf(stdin, NULL, _IONBF, 0);
        clearenv();
}

void banner(){
	puts("Welcome to Timmy's strings. This is the CLI to play with:)");
	puts("1. Create New String"); 
	puts("2. Edit Old String"); 
	puts("3. Delete String"); 
	puts("4. View String"); 
	printf(">");
}

int main(){
	init();	
	char* strings[100]; 	
	int option; 
	int iter = 1000;

	while(1){
		// Create String
		banner();
		scanf("%d", &option); 
		if(option == 1){	
			strings[iter] = create_string(); 
			iter += 1; 
		}
		// Edit String
		else if(option == 2){	
			printf("Index >");
			scanf("%d", &option);
			if(option >= 0 && option <= iter -1){
				edit_string(strings[option]);
			}
			else {
				puts("Improper Index");
			}
		}
		// Delete String
		else if(option == 3){
			printf("Index >");
			scanf("%d", &option); 
			if(option >= 0 && option <= iter - 1){
				delete_string(strings[option]);
				iter = iter - 1; 
			}
			else {
				puts("Improper Index");
			}

		}
		// View String
		else if(option == 4){
			printf("Index >");
			scanf("%d", &option); 
			if(option >= 0 && option <= iter - 1){
				view_string(strings[option]);
			}
			else {
				puts("Improper Index");
			}
		}
		else if(option == 5){
			return 1; 
		}
		else if(option == 1337){
			if(magic1 > 0x1337 && magic2 > 0x420){
				puts("Winner!"); 
				return 0; 
			}

		}
	}
}


