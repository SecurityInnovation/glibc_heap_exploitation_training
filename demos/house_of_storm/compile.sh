#!/bin/bash 

# Deals with the elfpatching and versioning for us

all_versions=( 2.23 2.26) 
file_name=house_of_storm

# Compile the code
$(gcc $file_name-2.23.c -o $file_name-2.23 -ggdb -O0)
$(gcc $file_name-2.26.c -fPIC -fPIE -pie -o $file_name-2.26 -ggdb -O0) 

echo "./.$file_name-2.23"
# Copy into a new version specific file 	
cp $file_name-2.23 ./.$file_name-2.23

# Get the loader and patch the loader of the new file
loader=$(realpath $(pwd)/../../libc_versions/2.23/ld-2.23.so)
patchelf --set-interpreter $loader ./.$file_name-2.23

echo "./.$file_name-2.26"
# Copy into a new version specific file 	
cp $file_name-2.26 ./.$file_name-2.26

# Get the loader and patch the loader of the new file
loader=$(realpath $(pwd)/../../libc_versions/2.26/ld-2.26.so)
patchelf --set-interpreter $loader ./.$file_name-2.26 

