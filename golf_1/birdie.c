#include <stdlib.h>
#include <stdio.h>

/*
gcc birdie.c -o birdie
*/

void* create_birdie(int index){
	
	int* ptr = malloc(0x30);

	// Sets our index value :) 	
	ptr[1] = index;
	return ptr;	
}

void* bogey(int* ptr){

	free(ptr);
}

// Should be run on a version without tcache
int main(){
	
	int *ptr_lst[50];
	int option;
	int last_index = 0;
	int begin_index = 0;

	// Pre-condition
	for (int i = 0; i < 5; i++){
		ptr_lst[last_index] = create_birdie(last_index);
		last_index += 1;
	}	

	printf("Options: \n");
	puts("1. Birdie");
	puts("2. Bogey");
	puts("3. Win?");

	while(1){

		scanf("%d", &option);
		if(option == 1){
			printf("Creating ptr %d\n", last_index);
			ptr_lst[last_index] = create_birdie(last_index);
			printf("%p - %d\n", ptr_lst[last_index], ptr_lst[last_index][1]);
			last_index += 1;
		}

		else if(option == 2 && begin_index != last_index){
			printf("Removing ptr at index %d\n", begin_index);
			bogey(ptr_lst[begin_index]);
			begin_index = begin_index + 1;
		}

		// Did you win?
		else if(option == 3){
			// Check the second index of the array
			if(ptr_lst[1][1] == 10){
				printf("Flag...\n");		
			}
		}
		
	}

	return 0;
}

